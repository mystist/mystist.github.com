I"×'<p>å‰å‡ å¤©è¢«é—®åˆ°Applyå’ŒCallæ–¹æ³•çš„åº”ç”¨åœºæ™¯ï¼Œç¨€é‡Œç³Šæ¶‚çš„ä¹±ç­”ä¸€æ°”ã€‚</p>

<p>æ¥ç€åˆè¢«é—®åˆ°å®ƒä»¬çš„åŸç†ï¼Œç›´æ¥è¯­å¡ã€‚</p>

<p>å¥½åœ¨ï¼Œæ±‚çŸ¥æ¬²è¿˜æ²¡æœ‰å½»åº•æ²¦é™·ï¼Œç»ˆäºç»™äº†è‡ªå·±ä¸€ä¸ªæ»¡æ„çš„ç­”æ¡ˆï¼š</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">// Custom the Javascript Apply &amp; Call method.</span>

<span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">customApply</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">obj</span><span class="p">.</span><span class="kd">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="dl">'</span><span class="s1">_temp</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">argStr</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">argStr</span> <span class="o">+=</span> <span class="dl">'</span><span class="s1">,arguments[1][</span><span class="dl">'</span><span class="o">+</span><span class="nx">i</span><span class="o">+</span><span class="dl">'</span><span class="s1">]</span><span class="dl">'</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">argStr</span> <span class="o">=</span> <span class="nx">argStr</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// Use slice(1) to remove the first ','</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">functionStr</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">obj._temp(</span><span class="dl">'</span><span class="o">+</span><span class="nx">argStr</span><span class="o">+</span><span class="dl">'</span><span class="s1">)</span><span class="dl">'</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">re</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">functionStr</span><span class="p">);</span>
  <span class="k">delete</span> <span class="nx">obj</span><span class="p">.</span><span class="kd">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_temp</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">re</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">customCall</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">customApply</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">customApply</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Cat</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">food</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">fish</span><span class="dl">'</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">Cat</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">say</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">param1</span><span class="p">,</span> <span class="nx">param2</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">I Love </span><span class="dl">'</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">food</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">, </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">param1</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">, </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">param2</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">blackCat</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cat</span><span class="p">();</span>
<span class="nx">blackCat</span><span class="p">.</span><span class="nx">say</span><span class="p">(</span><span class="dl">'</span><span class="s1">smallFish</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">bigFish</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Demo use.</span>
<span class="kd">var</span> <span class="nx">whiteDog</span> <span class="o">=</span> <span class="p">{</span><span class="na">food</span><span class="p">:</span> <span class="dl">'</span><span class="s1">bone</span><span class="dl">'</span><span class="p">};</span>
<span class="nx">Cat</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">say</span><span class="p">.</span><span class="nx">customApply</span><span class="p">(</span><span class="nx">whiteDog</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">Bone!</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">BONE!!!</span><span class="dl">'</span><span class="p">]);</span>
<span class="nx">Cat</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">say</span><span class="p">.</span><span class="nx">customCall</span><span class="p">(</span><span class="nx">whiteDog</span><span class="p">,</span> <span class="dl">'</span><span class="s1">smallBone</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">bigBone</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Unit test maybe.</span>
<span class="kd">function</span> <span class="nx">test</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">customCall</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">test</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

</code></pre></div></div>

<p>å¤åˆ¶ç²˜è´´ä»¥ä¸Šä»£ç åˆ°æ§åˆ¶å°å³å¯ã€‚</p>

<p>åŸç†ï¼š<br />
ä¸»è¦çœ‹customApplyè¿™ä¸ªé‡Œé¢çš„è¿™å¥ï¼š<br />
<code class="highlighter-rouge">obj.constructor.prototype['_temp'] = this;</code><br />
é¦–å…ˆï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯è¢«<code class="highlighter-rouge">say</code>è¿™ä¸ªæ–¹æ³•è°ƒç”¨çš„ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ï¼Œæ¯ä¸ª<code class="highlighter-rouge">function</code>å®é™…ä¸Šéƒ½æ˜¯<code class="highlighter-rouge">Function</code>çš„ä¸€ä¸ªå®ä¾‹ï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚<br />
æ‰€ä»¥ï¼Œè¿™é‡Œçš„<code class="highlighter-rouge">this</code>å®é™…ä¸Šå°±æ˜¯é‚£ä¸ª<code class="highlighter-rouge">say</code>æ–¹æ³•ã€‚<br />
è¿™å¥ä»£ç å…ˆæ˜¯ä¸ºä¼ è¿›æ¥çš„<code class="highlighter-rouge">obj</code>å¯¹è±¡çš„<code class="highlighter-rouge">prototype</code>å¯¹è±¡æ–°å¢äº†ä¸€ä¸ª<code class="highlighter-rouge">_temp</code>çš„å±æ€§ï¼Œç„¶åå°†<code class="highlighter-rouge">say</code>æ–¹æ³•èµ‹å€¼ç»™å®ƒã€‚<br />
ç®€å•çš„è®²ï¼Œå°±ç›¸å½“äºä¸º<code class="highlighter-rouge">obj</code>å¯¹è±¡æ·»åŠ äº†ä¸€ä¸ª<code class="highlighter-rouge">say</code>æ–¹æ³•ã€‚<br />
å°±è¿™æ ·<code class="highlighter-rouge">obj</code>å¯¹è±¡å°±å¯ä»¥è°ƒç”¨<code class="highlighter-rouge">say</code>æ–¹æ³•äº†ï¼Œè¾¾åˆ°äº†æˆ‘ä»¬çš„ç›®çš„ã€‚</p>

<p>åŸç†å°±æ˜¯è¿™æ ·ï¼Œå…¶ä»–çš„ä¸€äº›ä»£ç æ˜¯å¤„ç†åˆ«çš„äº‹æƒ…ï¼Œè·ŸåŸç†æ²¡ä»€ä¹ˆå…³ç³»ï¼Œå°±ä¸å¤šè¯´äº†ã€‚</p>

<p>ä¸çŸ¥é“Javascriptæºç æ˜¯ç”¨ä»€ä¹ˆåŸç†å®ç°<code class="highlighter-rouge">apply</code>å’Œ<code class="highlighter-rouge">call</code>çš„ï¼Œæˆ‘ä¸‹è½½äº†<code class="highlighter-rouge">Chrome V8</code>çš„æºç ï¼Œæ˜¯<code class="highlighter-rouge">C</code>å†™çš„ï¼Œçœ‹äº†ä»¥åå¤´æ›´å¤§äº†â€¦â€¦</p>

:ET